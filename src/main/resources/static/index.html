<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Listado de Patentes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 2rem;
    }
    h1 {
      color: #0044cc;
    }
    input[type="text"] {
      padding: 0.6rem;
      font-size: 1rem;
      width: 100%;
      max-width: 600px;
      margin-bottom: 1rem;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background: white;
      margin-bottom: 0.5rem;
      padding: 0.75rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    li:hover {
      background-color: #e6f0ff;
    }
    .highlight {
      background-color: #d9f2d9 !important;
      border-left: 5px solid green;
    }
    .section-title {
      margin-top: 2rem;
      color: #333;
    }
  </style>
</head>
<body>
  <main>
    <h1>Listado de Patentes</h1>

    <label for="buscador">Buscar patente:</label>
    <input type="text" id="buscador" aria-label="Buscar patente" placeholder="Escriba aquÃ­..." />

    <section aria-live="polite">
      <h2 class="section-title">Resultados filtrados</h2>
      <ul id="resultadosFiltrados"></ul>
    </section>

    <section>
      <h2 class="section-title">Todas las patentes</h2>
      <ul id="listadoCompleto"></ul>
    </section>
  </main>

  <script>
    const API_URL = "/api/equipo/dominio/disponibles";

    const buscador = document.getElementById("buscador");
    const resultadosFiltrados = document.getElementById("resultadosFiltrados");
    const listadoCompleto = document.getElementById("listadoCompleto");

    let patentes = [];

    function crearElemento(patente, contenedor, extraClass = "") {
      const li = document.createElement("li");
      li.textContent = patente;
      li.tabIndex = 0;
      li.className = extraClass;
      li.setAttribute("role", "link");
      li.setAttribute("aria-label", `Ver perfil de la patente ${patente}`);
      li.onclick = () => {
        window.location.href = `perfil_camion.html?dominio=${encodeURIComponent(patente)}`;
      };
      contenedor.appendChild(li);
    }

    function filtrarPatentes(texto) {
      resultadosFiltrados.innerHTML = "";
      const filtro = texto.toLowerCase();
      const coincidencias = patentes.filter(p => p.toLowerCase().includes(filtro));
      coincidencias.forEach(patente => crearElemento(patente, resultadosFiltrados, "highlight"));
    }

    fetch(API_URL)
      .then(response => response.json())
      .then(data => {
        patentes = data;
        // Mostrar todas las patentes inicialmente
        patentes.forEach(patente => crearElemento(patente, listadoCompleto));
      });

    buscador.addEventListener("input", e => filtrarPatentes(e.target.value));
  </script>
</body>
</html>
