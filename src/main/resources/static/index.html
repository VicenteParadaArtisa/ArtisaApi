<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Listado de Patentes</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <style>
    body {
      background-color: #f5f5f5;
    }
    .patente-btn {
      text-align: left;
    }
  </style>
</head>
<body>
  <main class="container py-4" role="main">
    <h1 class="mb-4 text-primary">Listado de Patentes</h1>

    <div class="mb-3">
      <label for="buscador" class="form-label">Buscar patente:</label>
      <input type="text" id="buscador" class="form-control" aria-label="Buscar patente por texto" placeholder="Ej: TWPY41" />
    </div>

    <section id="listado-patentes" aria-live="polite">
      <!-- Aquí se inyectarán las patentes -->
    </section>
  </main>

  <script>
    async function cargarPatentes() {
      try {
        const res = await fetch('/api/equipo/dominio/disponibles');
        const patentes = await res.json();
        mostrarListado(patentes);
      } catch (e) {
        document.getElementById('listado-patentes').innerHTML = '<p>Error al cargar patentes</p>';
      }
    }

    function mostrarListado(patentes) {
      const contenedor = document.getElementById('listado-patentes');
      contenedor.innerHTML = '';

      patentes.forEach(patente => {
        const boton = document.createElement('a');
        boton.className = 'btn btn-light mb-2 patente-btn';
        boton.setAttribute('role', 'button');
        boton.setAttribute('aria-label', `Ver perfil del camión ${patente}`);
        boton.href = `/perfil_camion.html?dominio=${encodeURIComponent(patente)}`;
        boton.textContent = patente;
        contenedor.appendChild(boton);
      });
    }

    document.getElementById('buscador').addEventListener('input', function () {
      const texto = this.value.toLowerCase();
      const botones = document.querySelectorAll('#listado-patentes a');
      botones.forEach(btn => {
        const visible = btn.textContent.toLowerCase().includes(texto);
        btn.style.display = visible ? '' : 'none';
      });
    });

    cargarPatentes();
  </script>
</body>
</html>
